---
description: テスト駆動開発ワークフローを強制する。インターフェースを定義し、最初にテストを生成し、最小限のコードで実装する。80%以上のカバレッジを確保する。
---

# TDDコマンド

このコマンドは**tdd-guide**エージェントを呼び出して、テスト駆動開発の手法を強制します。

## このコマンドが行うこと

1. **インターフェースの定義** - 最初に型/インターフェースを定義
2. **最初にテストを生成** - 失敗するテストを書く（RED）
3. **最小限のコードを実装** - テストを通すのに十分なコードを書く（GREEN）
4. **リファクタリング** - テストを緑のままに保ちながらコードを改善（REFACTOR）
5. **カバレッジの確認** - 80%以上のテストカバレッジを確保

## 使用タイミング

`/tdd`を使用する場合：

- 新機能を実装する時
- 新しい関数/コンポーネントを追加する時
- バグを修正する時（まずバグを再現するテストを書く）
- 既存コードをリファクタリングする時
- 重要なビジネスロジックを構築する時

## 動作方法

tdd-guideエージェントは以下を実行します：

1. 入力/出力の**インターフェースを定義**
2. **失敗するテストを書く**（コードがまだ存在しないため）
3. **テストを実行**し、正しい理由で失敗することを確認
4. テストを通す**最小限の実装**を書く
5. **テストを実行**し、通過することを確認
6. テストを緑のままに保ちながら**リファクタリング**
7. **カバレッジを確認**し、80%未満の場合は追加のテストを書く

## TDDサイクル

```text
RED → GREEN → REFACTOR → REPEAT

RED:      失敗するテストを書く
GREEN:    テストを通す最小限のコードを書く
REFACTOR: コードを改善し、テストは緑のまま
REPEAT:   次の機能/シナリオ
```

## TDDのベストプラクティス

**推奨**:

- ✅ 実装の前にテストを書く
- ✅ 実装前にテストを実行し、失敗することを確認
- ✅ テストを通す最小限のコードを書く
- ✅ テストが緑になってからリファクタリング
- ✅ エッジケースとエラーシナリオを追加
- ✅ 80%以上のカバレッジを目指す（重要なコードは100%）

**非推奨**:

- ❌ テストより先に実装を書く
- ❌ 各変更後にテストを実行しない
- ❌ 一度に大量のコードを書く
- ❌ 失敗するテストを無視する
- ❌ 実装の詳細をテストする（動作をテストする）
- ❌ すべてをモックする（統合テストを優先）

## 含めるべきテストタイプ

**単体テスト**（関数レベル）:

- 正常系シナリオ
- エッジケース（空、null、最大値）
- エラー条件
- 境界値

**統合テスト**（コンポーネントレベル）:

- APIエンドポイント
- データベース操作
- 外部サービス呼び出し
- フックを使用するReactコンポーネント

**E2Eテスト**（`/e2e`コマンドを使用）:

- 重要なユーザーフロー
- マルチステッププロセス
- フルスタック統合

## カバレッジ要件

- **最小80%** すべてのコード
- **100%必須** 以下について:
  - 金融計算
  - 認証ロジック
  - セキュリティクリティカルなコード
  - コアビジネスロジック

## 重要な注意事項

**必須**: テストは実装の前に書く必要があります。TDDサイクルは：

1. **RED** - 失敗するテストを書く
2. **GREEN** - テストを通すために実装
3. **REFACTOR** - コードを改善

REDフェーズをスキップしないでください。テストより先にコードを書かないでください。

## 他のコマンドとの統合

- `/plan`を最初に使用して、何を構築するか理解する
- `/tdd`を使用してテストで実装する
- ビルドエラーが発生した場合は`/build-fix`を使用
- `/code-review`を使用して実装をレビュー
- `/test-coverage`を使用してカバレッジを確認

## 関連エージェント

このコマンドは`tdd-guide`エージェントを呼び出します：
`.cursor/agents/tdd-guide.md`
